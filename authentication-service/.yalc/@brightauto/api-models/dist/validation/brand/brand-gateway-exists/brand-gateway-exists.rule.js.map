{"version":3,"sources":["../../../../src/validation/brand/brand-gateway-exists/brand-gateway-exists.rule.ts"],"sourcesContent":["import { Injectable } from \"@nestjs/common\";\nimport { ValidationArguments, ValidatorConstraint, ValidatorConstraintInterface } from \"class-validator\";\nimport { PaymentGatewayKey } from \"../../../orm-config\";\nimport { DataSource } from \"typeorm\";\n\n@ValidatorConstraint({ name: 'BrandGatewayExists', async: true })\n@Injectable()\nexport class BrandGatewayExistsRule implements ValidatorConstraintInterface {\n  constructor(private dataSource: DataSource) {}\n\n  async validate(value: any, args: ValidationArguments) {\n    try {\n      const [model] = args.constraints;\n      const input = (args.object as any);\n      const paymentGatewayId = input['paymentGatewayId'];\n      const primaryBrandId = input['primaryBrandId'];\n      await this.dataSource.getRepository(PaymentGatewayKey).findOneOrFail({ where: { brand: { id: primaryBrandId }, paymentGateway: { id: paymentGatewayId } } });\n    } catch (e) {\n      // console.log(e)\n      return false;\n    }\n\n    return true;\n  }\n\n  defaultMessage(args: ValidationArguments) {\n    // console.log('relation constraint array -->', args.constraints[1]);\n    return `Brand doesn't support this payment`;\n  }\n}"],"names":["BrandGatewayExistsRule","validate","value","args","model","constraints","input","object","paymentGatewayId","primaryBrandId","dataSource","getRepository","PaymentGatewayKey","findOneOrFail","where","brand","id","paymentGateway","e","defaultMessage","constructor","ValidatorConstraint","name","async","Injectable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAOaA;;;eAAAA;;;wBAPc;gCAC4D;2BACrD;yBACP;;;;;;;;;;AAIpB,IAAA,AAAMA,yBAAN,MAAMA;IAGX,MAAMC,SAASC,KAAU,EAAEC,IAAyB,EAAE;QACpD,IAAI;YACF,MAAM,CAACC,MAAM,GAAGD,KAAKE,WAAW;YAChC,MAAMC,QAASH,KAAKI,MAAM;YAC1B,MAAMC,mBAAmBF,KAAK,CAAC,mBAAmB;YAClD,MAAMG,iBAAiBH,KAAK,CAAC,iBAAiB;YAC9C,MAAM,IAAI,CAACI,UAAU,CAACC,aAAa,CAACC,4BAAiB,EAAEC,aAAa,CAAC;gBAAEC,OAAO;oBAAEC,OAAO;wBAAEC,IAAIP;oBAAe;oBAAGQ,gBAAgB;wBAAED,IAAIR;oBAAiB;gBAAE;YAAE;QAC5J,EAAE,OAAOU,GAAG;YACV,iBAAiB;YACjB,OAAO;QACT;QAEA,OAAO;IACT;IAEAC,eAAehB,IAAyB,EAAE;QACxC,qEAAqE;QACrE,OAAO,CAAC,kCAAkC,CAAC;IAC7C;IApBAiB,YAAY,AAAQV,UAAsB,CAAE;aAAxBA,aAAAA;IAAyB;AAqB/C;AAtBaV;IAFZqB,IAAAA,mCAAmB,EAAC;QAAEC,MAAM;QAAsBC,OAAO;IAAK;IAC9DC,IAAAA,kBAAU;;;eAEuB,mBAAU,4BAAV,mBAAU;;GAD/BxB"}